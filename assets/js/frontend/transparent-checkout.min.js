!function(p){"use strict";p(function(){var u=!1;function a(e){p("#pagseguro-credit-card-form").attr("data-credit-card-brand",e)}function t(e){return'<option value="'+e.quantity+'" data-installment-value="'+e.installmentAmount+'">'+(r=e,a="R$ "+parseFloat(r.installmentAmount,10).toFixed(2).replace(".",",").toString(),t="R$ "+parseFloat(r.totalAmount,10).toFixed(2).replace(".",",").toString(),o=!0===r.interestFree?" "+wc_pagseguro_params.interest_free:"",n=o||" ("+t+")",r.quantity+"x "+a+n)+"</option>";var r,a,t,o,n}function g(e){var r=p("#pagseguro-credit-card-form");p(".woocommerce-error",r).remove(),r.prepend('<div class="woocommerce-error" style="margin-bottom: 0.5em !important;">'+e+"</div>"),p(document.body).trigger("checkout_error"),p(document.body).trigger("pagSeguroError",e)}function n(e){p(".pagseguro-method-form").hide(),p("#pagseguro-payment-methods li").removeClass("active"),p("#pagseguro-"+e+"-form").show(),p("#pagseguro-payment-method-"+e).parent("label").parent("li").addClass("active")}function e(){var e;e=p("#pagseguro-payment-methods"),1===p("input[type=radio]",e).length&&e.hide(),p("#pagseguro-payment-form").show(),n(p("#pagseguro-payment-methods input[type=radio]:checked").val()),p("#pagseguro-card-holder-cpf").mask("000.000.000-00"),p("#pagseguro-card-holder-birth-date").mask("00/00/0000");var o=function(e){return 11===e.replace(/\D/g,"").length?"(00) 00000-0000":"(00) 0000-00009"},r={onKeyPress:function(e,r,a,t){a.mask(o.apply({},arguments),t)}};p("#pagseguro-card-holder-phone").mask(o,r),p("#pagseguro-bank-transfer-form input[type=radio]:checked").parent("label").parent("li").addClass("active")}function r(){if(u)return!(u=!1);if(!p("#payment_method_pagseguro").is(":checked"))return!0;if("credit-card"!==p("body li.payment_method_pagseguro input[name=pagseguro_payment_method]:checked").val())return p("form.checkout, form#order_review").append(p('<input name="pagseguro_sender_hash" type="hidden" />').val(PagSeguroDirectPayment.getSenderHash())),!0;var r=p("form.checkout, form#order_review"),e=!1,a="",t=p("#pagseguro-credit-card-form",r).attr("data-credit-card-brand"),o=p("#pagseguro-card-number",r).val().replace(/[^\d]/g,""),n=p("#pagseguro-card-cvc",r).val(),i=p("#pagseguro-card-expiry",r).val().replace(/[^\d]/g,"").substr(0,2),d=p("#pagseguro-card-expiry",r).val().replace(/[^\d]/g,"").substr(2),s=p("#pagseguro-card-installments",r),c=new Date;return a+="<ul>",void 0!==t&&"error"!==t||(a+="<li>"+wc_pagseguro_params.invalid_card+"</li>",e=!0),2===i.length&&4===d.length||(a+="<li>"+wc_pagseguro_params.invalid_expiry+"</li>",e=!0),2===i.length&&4===d.length&&(12<i||d<=c.getFullYear()-1||d>=c.getFullYear()+20||i<c.getMonth()+2&&d.toString()===c.getFullYear().toString())&&(a+="<li>"+wc_pagseguro_params.expired_date+"</li>",e=!0),"0"===s.val()&&(a+="<li>"+wc_pagseguro_params.empty_installments+"</li>",e=!0),a+="</ul>",e?g(a):PagSeguroDirectPayment.createCardToken({brand:t,cardNumber:o,cvv:n,expirationMonth:i,expirationYear:d,success:function(e){p("input[name=pagseguro_credit_card_hash], input[name=pagseguro_credit_card_hash], input[name=pagseguro_installment_value]",r).remove(),r.append(p('<input name="pagseguro_credit_card_hash" type="hidden" />').val(e.card.token)),r.append(p('<input name="pagseguro_sender_hash" type="hidden" />').val(PagSeguroDirectPayment.getSenderHash())),r.append(p('<input name="pagseguro_installment_value" type="hidden" />').val(p("option:selected",s).attr("data-installment-value"))),u=!0,r.submit()},error:function(){g(wc_pagseguro_params.general_error)}}),!1}wc_pagseguro_params.session_id?(PagSeguroDirectPayment.setSessionId(wc_pagseguro_params.session_id),"1"===wc_checkout_params.is_checkout?p("body").on("updated_checkout",function(){e()}):e(),p("body").on("click","#pagseguro-bank-transfer-form input[type=radio]",function(){p("#pagseguro-bank-transfer-form li").removeClass("active"),p(this).parent("label").parent("li").addClass("active")}),p("body").on("click","#pagseguro-payment-methods input[type=radio]",function(){n(p(this).val())}),p("body").on("focusout","#pagseguro-card-number",function(){var e=p(this).val().replace(/[^\d]/g,"").substr(0,6),r=p("body #pagseguro-card-installments");6===e.length&&(r.empty(),r.attr("disabled","disabled"),PagSeguroDirectPayment.getBrand({cardBin:e,success:function(e){p("body").trigger("pagseguro_credit_card_brand",e.brand.name),a(e.brand.name)},error:function(){p("body").trigger("pagseguro_credit_card_brand","error"),a("error")}}))}),p("body").on("updated_checkout",function(){var e=p("body #pagseguro-card-number");0<e.length&&e.focusout()}),p("body").on("focus","#pagseguro-card-number, #pagseguro-card-expiry",function(){p("#pagseguro-credit-card-form .woocommerce-error").remove()}),p("body").on("pagseguro_credit_card_brand",function(e,r){"error"!==r?PagSeguroDirectPayment.getInstallments({amount:p("body #pagseguro-payment-form").data("cart_total"),brand:r,success:function(e){var a=p("body #pagseguro-card-installments");!1===e.error?(a.empty(),a.removeAttr("disabled"),a.append('<option value="0">--</option>'),p.each(e.installments[r],function(e,r){a.append(t(r))})):g(wc_pagseguro_params.invalid_card)},error:function(){g(wc_pagseguro_params.invalid_card)}}):g(wc_pagseguro_params.invalid_card)}),p("form.checkout").on("checkout_place_order_pagseguro",function(){return r()}),p("form#order_review").submit(function(){return r()})):p("body").on("updated_checkout",function(){p("#pagseguro-payment-form").remove()})})}(jQuery);